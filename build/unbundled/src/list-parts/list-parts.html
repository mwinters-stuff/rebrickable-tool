<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-data-table/iron-data-table.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="list-of-parts.html">
<link rel="import" href="../part-search-dialog/part-search-dialog.html">

</head><body><dom-module id="list-parts">
  <template>
    <style include="shared-styles">:host{display:block;}</style>
    <paper-toast id="toast">
    </paper-toast>

    <iron-ajax id="theAjax" auto="{{showing}}" url="https://rebrickable.com/api/get_user_part_lists" params="{{_params}}" handle-as="json" on-response="_handleResponse"></iron-ajax>
    <part-search-dialog id="partSearch" on-accepted="_onAddSearchAccepted" quantity="{{_addQuantity}}" colour="{{_addColour}}" show-quantity-input=""></part-search-dialog>
    <paper-material elevation="1">
      <list-of-parts id="listOfParts" user-hash="{{userHash}}" part-list-id="{{partListId}}" parts-changed="{{_partsChanged}}" editable=""></list-of-parts>
      <paper-fab style="position:absolute; bottom: 30px; right:94px" icon="icons:save" on-click="_onSaveClick" hidden$="{{!_partsChanged}}"></paper-fab>
      <paper-fab style="position:absolute; bottom: 30px; right:24px" icon="icons:add" on-click="_onAddClick"></paper-fab>
    </paper-material>
  </template>
  <script>!function(){"use strict";Polymer({is:"list-parts",properties:{userHash:{type:String,observer:"_onHashChanged"},_params:{type:Object},_addColour:{type:Number},_addQuantity:{type:Number},showing:{type:Boolean},tabsToShow:{type:Object,notify:!0},partListId:{type:Number,notify:!0}},_handleResponse:function(t){if(t.detail.response&&(this._data=t.detail.response.partlists,this._data.length>0&&!this.partListId&&this.set("route.path","/app/list-parts/"+this._data[0].partlist_id),this.showing)){var s={selected:this.partListId,route:"parts",tabs:[]};this._data.forEach(function(t){s.tabs.push({route:"/app/list-parts/"+t.partlist_id,title:t.descr})}.bind(this)),this.set("tabsToShow",s),this.saveTabsToShow=s}},_onHashChanged:function(){this.set("_params",{key:"p4GLMlcPxJ",hash:this.userHash,format:"json"})},_onAddClick:function(){this.$.partSearch.open()},_onAddSearchAccepted:function(t){this.$.listOfParts.addPart(t.detail.part_id,t.detail.part_type_id,t.detail.descr,this._addQuantity,this._addColour)},_onSaveClick:function(){this.$.listOfParts.savePartList(function(t){this.$.toast.text=t?"Part List Saved...":"ERROR Saving Part List",this.$.toast.open()}.bind(this))}})}();</script>
</dom-module>
</body></html>