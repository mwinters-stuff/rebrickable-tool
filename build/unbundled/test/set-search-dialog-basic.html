<!DOCTYPE html><html><head>
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,user-scalable=yes">
  <title>set-search-dialog</title>

  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>

  <script src="../bower_components/iron-test-helpers/mock-interactions.js"></script>
  
  <link rel="import" href="../bower_components/iron-test-helpers/iron-test-helpers.html">
  <link rel="import" href="../src/set-search-dialog/set-search-dialog.html">

</head>

<body>

  <test-fixture id="basic">
    <template>
      <set-search-dialog></set-search-dialog>
    </template>
  </test-fixture>

  <script>function runAfterOpen(e,t){var r=function(){e.$$("paper-dialog").removeEventListener("iron-overlay-opened",r),Polymer.Base.async(t,1)};e.$$("paper-dialog").addEventListener("iron-overlay-opened",r),e.open()}describe("set-search-dialog tests",function(){var e,t,r,o,c,a,i,s,p;afterEach(function(){t.restore(),e.removeEventListener("loading-finished",s),e.removeEventListener("accepted",p)}),beforeEach(function(){e=fixture("basic"),Polymer.dom.flush(),t=sinon.fakeServer.create(),r=e.$$('paper-radio-button[name="M"]'),o=e.$$('paper-radio-button[name="S"]'),c=e.$$("#_searchDialogInput"),a=e.$$("[dialog-confirm]"),i=e.$$("#dataTable"),t.respondWith("https://rebrickable.com/api/search?key=p4GLMlcPxJ&format=json&type=S&query=nothing",[200,{"Content-Type":"application/json"},'{"results":[]}']),t.respondWith("https://rebrickable.com/api/search?key=p4GLMlcPxJ&format=json&type=S&query=4200",[200,{"Content-Type":"application/json"},'{"results":[{"set_id":"42006-1-b1","year":"2013","pieces":"622","theme1":"Technic","theme2":"Model","theme3":"Construction","accessory":0,"kit":0,"descr":"Tracked Tractor","url":"https://rebrickable.com/sets/42006-1-b1/tracked-tractor-construction-2013","img_tn":"https://rebrickable.com/img/sets-t/42006-1-b1.jpg","img_sm":"https://rebrickable.com/img/sets-s/42006-1-b1.jpg","img_big":"https://rebrickable.com/img/sets-b/42006-1-b1.jpg"},{"set_id":"42006-1","year":"2013","pieces":"721","theme1":"Technic","theme2":null,"theme3":null,"accessory":0,"kit":0,"descr":"Excavator","url":"https://rebrickable.com/sets/42006-1/excavator-technic-2013","img_tn":"https://rebrickable.com/img/sets-t/42006-1.jpg","img_sm":"https://rebrickable.com/img/sets-s/42006-1.jpg","img_big":"https://rebrickable.com/img/sets-b/42006-1.jpg"}]}']),t.respondWith("https://rebrickable.com/api/search?key=p4GLMlcPxJ&format=json&type=M&query=grader",[200,{"Content-Type":"application/json"},'{"results":[{"set_id":"MOC-4569","year":"2016","pieces":"69","theme1":"Creator","theme2":null,"theme3":null,"accessory":0,"kit":0,"descr":"Grader","url":"https://rebrickable.com/mocs/Zagdima/grader","img_tn":"https://rebrickable.com/img/sets-t/MOC-4569.jpg","img_sm":"https://rebrickable.com/img/sets-s/MOC-4569.jpg","img_big":"https://rebrickable.com/img/sets-b/MOC-4569.jpg"},{"set_id":"MOC-1367","year":"2014","pieces":"254","theme1":"Technic","theme2":"Model","theme3":"Construction","accessory":0,"kit":0,"descr":"Grader","url":"https://rebrickable.com/mocs/tomik/grader","img_tn":"https://rebrickable.com/img/sets-t/MOC-1367.jpg","img_sm":"https://rebrickable.com/img/sets-s/MOC-1367.jpg","img_big":"https://rebrickable.com/img/sets-b/MOC-1367.jpg"},{"set_id":"MOC-1113","year":"2013","pieces":"103","theme1":"Technic","theme2":null,"theme3":null,"accessory":0,"kit":0,"descr":"Road Grader","url":"https://rebrickable.com/mocs/kgodwin/road-grader","img_tn":"https://rebrickable.com/img/sets-t/MOC-1113.jpg","img_sm":"https://rebrickable.com/img/sets-s/MOC-1113.jpg","img_big":"https://rebrickable.com/img/sets-b/MOC-1113.jpg"},{"set_id":"MOC-2352","year":"2014","pieces":"618","theme1":"Technic","theme2":"Model","theme3":"Construction","accessory":0,"kit":0,"descr":"Grader CAT 24M","url":"https://rebrickable.com/mocs/higgins91/niveleuse-cat-24m","img_tn":"https://rebrickable.com/img/sets-t/MOC-2352.jpg","img_sm":"https://rebrickable.com/img/sets-s/MOC-2352.jpg","img_big":"https://rebrickable.com/img/sets-b/MOC-2352.jpg"}]}'])}),it("initial state checks",function(t){runAfterOpen(e,function(){expect(r).to.be.ok,expect(o).to.be.ok,expect(c).to.be.ok,expect(a).to.be.ok,expect(i).to.be.ok,expect(r).to.have.property("checked",!0),expect(o).to.have.property("checked",!1),expect(c).to.have.property("value",""),expect(a).to.have.property("disabled",!0),expect(i).to.have.property("selectionEnabled"),t()})}),it("search for a set",function(n){runAfterOpen(e,function(){MockInteractions.tap(Polymer.dom(e.root).querySelector('paper-radio-button[name="S"]')),expect(r).to.have.property("checked",!1),expect(o).to.have.property("checked",!0),e._searchInput="4200",expect(c).to.have.property("value","4200"),s=function(){expect(e._dataSearch).to.be.ok,expect(e._dataSearch).to.have.lengthOf(2),expect(a).to.have.property("disabled",!0),expect(i).to.have.property("size",2),i.selectItem(0),expect(a).to.have.property("disabled",!1),expect(e).to.have.property("_selectedSearchSet",e._dataSearch[0]),MockInteractions.tap(Polymer.dom(e.root).querySelector("[dialog-confirm]"))},p=function(){e.removeEventListener("accepted",this),expect(e).to.have.property("result",e._dataSearch[0]),n()},e.addEventListener("loading-finished",s),e.addEventListener("accepted",p),MockInteractions.pressEnter(Polymer.dom(e.root).querySelector("#_searchDialogInput")),t.respond()})}),it("search for a moc",function(n){runAfterOpen(e,function(){MockInteractions.tap(Polymer.dom(e.root).querySelector('paper-radio-button[name="M"]')),expect(r).to.have.property("checked",!0),expect(o).to.have.property("checked",!1),e._searchInput="grader",expect(c).to.have.property("value","grader"),s=function(){e.removeEventListener("loading-finished",this),expect(e._dataSearch).to.be.ok,expect(e._dataSearch).to.have.lengthOf(4),expect(a).to.have.property("disabled",!0),expect(i).to.have.property("size",4),i.selectItem(1),expect(a).to.have.property("disabled",!1),expect(e).to.have.property("_selectedSearchSet",e._dataSearch[1]),MockInteractions.tap(Polymer.dom(e.root).querySelector("[dialog-confirm]"))},p=function(){e.removeEventListener("accepted",this),expect(e).to.have.property("result",e._dataSearch[1]),n()},e.addEventListener("loading-finished",s),e.addEventListener("accepted",p),MockInteractions.pressEnter(Polymer.dom(e.root).querySelector("#_searchDialogInput")),t.respond()})}),it("search for nothing",function(p){runAfterOpen(e,function(){MockInteractions.tap(Polymer.dom(e.root).querySelector('paper-radio-button[name="S"]')),expect(r).to.have.property("checked",!1),expect(o).to.have.property("checked",!0),e._searchInput="nothing",expect(c).to.have.property("value","nothing"),s=function(){expect(e._dataSearch).to.be.ok,expect(e._dataSearch).to.have.lengthOf(0),expect(a).to.have.property("disabled",!0),expect(i).to.have.property("size",0),p()},e.addEventListener("loading-finished",s),MockInteractions.pressEnter(Polymer.dom(e.root).querySelector("#_searchDialogInput")),t.respond()})})});</script>




</body></html>