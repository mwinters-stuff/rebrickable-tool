<html><head><meta charset="UTF-8"><link rel="import" href="../main-app/main-app.html"></head><body><div hidden="" by-vulcanize=""><dom-module id="part-list-add-dialog" assetpath="/">
  <template>
  <style include="shared-styles">:host{display:block;}paper-dialog{width:400px;}</style>
    <paper-dialog id="_dialog" on-iron-overlay-closed="_onDialogClosed">
      <h2>Add Part List</h2>
      <paper-input autofocus="" id="_inputName" label="Name" value="{{name}}">
      </paper-input>
      <div class="horiz">
        <div>List Type</div>
        <paper-radio-group selected="{{useAs}}" attr-for-selected="name">
          <paper-radio-button name="1">Use in Builds</paper-radio-button>
          <paper-radio-button name="2">Don`t use in Builds</paper-radio-button>
        </paper-radio-group>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button dialog-confirm="">OK</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>!function(){"use strict";Polymer({is:"part-list-add-dialog",properties:{name:{type:String,value:"",notify:!0},useAs:{type:String,value:"2",notify:!0}},_onDialogClosed:function(i){i.detail.confirmed&&this.fire("accepted")},open:function(){this.$._dialog.open()}})}();</script>
</dom-module>
</div><dom-module id="manage-part-lists">
  <template>
    <style include="shared-styles">:host{display:block;}</style>
    <iron-ajax id="theAjaxtLists" method="GET" url="https://rebrickable.com/api/get_user_part_lists" params="{{_params}}" handle-as="json" last-response="{{_data}}"></iron-ajax>
    <iron-ajax id="theAjaxDelete" method="POST" url="https://rebrickable.com/api/del_user_partlist" content-type="application/x-www-form-urlencoded" handle-as="text" on-response="_onDeleteResponse"></iron-ajax>
    <iron-ajax id="theAjaxAdd" method="POST" url="https://rebrickable.com/api/add_user_partlist" content-type="application/x-www-form-urlencoded" handle-as="text" on-response="_onAddResponse"></iron-ajax>

    <paper-toast id="toast">
    </paper-toast>

    <question-dialog id="_questionDelete" title="Delete Part List" on-dialog-closed="_onDeleteDialogClosed">
      Do you want to delete part list <b>{{_listItem.descr}}</b>?<br>
      All parts in this list will be deleted.
    </question-dialog>

    <part-list-add-dialog id="_addDialog" name="{{_dialogAddName}}" use-as="{{_dialogAddUseAs}}" on-accepted="_onAddDialogAccepted"></part-list-add-dialog>

    <paper-material elevation="1">
      <iron-data-table id="dataTable" items="[[_data.partlists]]" on-selected-item-changed="_onItemSelected" selection-enabled="" style$="height: [[_height]]px">
        <data-table-column name="Name" flex="50">
          <template>[[item.descr]]</template>
        </data-table-column>
        <data-table-column align-right="" name="Parts" flex="1">
          <template>[[item.qty]]</template>
        </data-table-column>
        <data-table-column name="Type" flex="1">
          <template>[[_typeToDescription(item.type)]]</template>
        </data-table-column>
        <data-table-column width="40px">
          <template>
            <paper-icon-button icon="icons:delete" list-item="[[item]]" on-tap="_onDeleteItemClick"></paper-icon-button>
          </template>
        </data-table-column>
      </iron-data-table>
      <paper-fab style="position:absolute; bottom: 30px; right:24px" icon="icons:add" on-click="_onAddClick"></paper-fab>

    </paper-material>
  </template>
  <script>!function(){"use strict";Polymer({is:"manage-part-lists",properties:{userHash:{type:String,value:"",observer:"_onHashChanged"},showing:{type:Boolean,value:!1,observer:"_onShowingChanged"},tabsToShow:{type:Object,value:{},notify:!0},_data:{type:Object},_height:{type:Number,value:400},_listItem:{type:Object,value:{}},_params:{type:Object},_dialogAddName:{type:String},_dialogAddUseAs:{type:String}},_onHashChanged:function(){this.userHash&&(this._data={},this._params={key:"p4GLMlcPxJ",hash:this.userHash,format:"json"})},_onShowingChanged:function(){this.showing&&this.set("tabsToShow.tabs",[]),this.$.theAjaxtLists.auto=this.showing},_typeToDescription:function(e){switch(XP.toNumber(e)){case 1:return"Use in Builds";case 2:return"Don't use in Builds";default:return e+" - Unknown"}},attached:function(){this.async(this._resizeTable),window.addEventListener("resize",function(){this.debounce("parts-resize",this._resizeTable,1e3)}.bind(this))},_resizeTable:function(){var e=document.getElementById("paperDrawerPanel"),t=document.getElementById("appHeader");e&&t&&this.set("_height",e.clientHeight-t.clientHeight-120)},_onItemSelected:function(){},_onAddClick:function(){this.$._addDialog.open()},_onAddDialogAccepted:function(){this.$.theAjaxAdd.body={key:"p4GLMlcPxJ",hash:this.userHash,format:"json",descr:this._dialogAddName,type:this._dialogAddUseAs},this.$.theAjaxAdd.generateRequest()},_onAddResponse:function(e){XP.startsWith(e.detail.response,"SUCCESS")?this.$.theAjaxtLists.generateRequest():(this.$.toast.text="Failed to add set list! "+e.detail.response,this.$.toast.open())},_onDeleteItemClick:function(e){for(var t=null,s=0;s<e.path.length;s++)if(e.path[s].listItem){t=e.path[s].listItem;break}t&&(this.set("_listItem",t),this.$._questionDelete.open())},_onDeleteDialogClosed:function(e){e.detail.confirmed&&(this.$.theAjaxDelete.body={key:"p4GLMlcPxJ",hash:this.userHash,format:"json",partlist_id:this._listItem.partlist_id},this.$.theAjaxDelete.generateRequest())},_onDeleteResponse:function(e){XP.startsWith(e.detail.response,"SUCCESS")?this.$.theAjaxtLists.generateRequest():(this.$.toast.text="Failed to remove set list! "+e.detail.response,this.$.toast.open())}})}();</script>
</dom-module>
</body></html>