<html><head><meta charset="UTF-8"><link rel="import" href="../main-app/main-app.html"></head><body><div hidden="" by-vulcanize=""><dom-module id="part-types" assetpath="../part-types/">
  <template>
    <style>:host{display:none;}</style>
    <iron-ajax id="theAjax" url="https://rebrickable.com/api/get_part_types" params="{{_params}}" handle-as="json" on-response="_handleResponse"></iron-ajax>
    </template>
  <script>!function(){"use strict";Polymer({is:"part-types",properties:{partTypes:{type:Array,value:[],notify:!0},_params:{type:Object}},attached:function(){window._partTypes&&0!==window._partTypes.length?this.set("partTypes",XP.clone(window._partTypes)):(this.set("_params",{key:"p4GLMlcPxJ",format:"json"}),this.$.theAjax.auto=!0)},_handleResponse:function(t){t.detail.response&&(this.set("partTypes",t.detail.response.part_types),window._partTypes=XP.clone(this.partTypes))},getPartType:function(t){return XP.find(this.partTypes,function(e){return XP.toNumber(e.part_type_id)===XP.toNumber(t)})},recentUsed:function(t){var e=this.getPartType(t);if(e){var p=XP.indexOf(this.partTypes,e);this.set("partTypes",XP.moveFirst(XP.clone(this.partTypes),p,1)),window._partTypes=XP.clone(this.partTypes)}}})}();</script>
</dom-module>
<dom-module id="part-search-dialog" assetpath="../part-search-dialog/">
  <template>
    <style include="shared-styles">:host{display:block;}iron-data-table{height:200px;}paper-dialog{width:600px;}</style>
    <part-types id="_partTypesElement" part-types="{{_partTypes}}"></part-types>
    <colour-list id="_colourListElement" list="{{_colours}}"></colour-list>

    <paper-dialog id="_dialog" on-iron-overlay-closed="_onDialogClosed">
      <h2>Search MOC or Set</h2>
      <paper-dropdown-menu id="_dropdownPartType" label="Part Type" selected-item="{{_selectedPartType}}" style="width:90%">
        <paper-listbox id="_dropdownPartTypeList" class="dropdown-content">
          <template is="dom-repeat" items="{{_partTypes}}">
            <paper-item part_type_id="{{item.part_type_id}}">{{item.desc}}</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      <paper-dropdown-menu id="_dropdownColour" label="Part Colour" selected-item="{{_selectedPartColour}}" style="width:90%">
        <paper-listbox id="_dropdownColourList" class="dropdown-content">
          <template is="dom-repeat" items="{{_colours}}">
            <paper-item rb_color_id="{{item.rb_color_id}}">
              <div class="box" style="background-color: {{item.rgb}}"></div>{{item.name}}</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      <iron-a11y-keys id="_a11y" target="[[_targetKeys]]" keys="enter" on-keys-pressed="_onSearchDialogSearch"></iron-a11y-keys>
      <paper-input autofocus="" id="_searchDialogInput" label="Search" value="{{_searchInput::input}}">
        <paper-icon-button suffix="" icon="search" raised="" on-click="_onSearchDialogSearch" disabled="{{_searchTermsBad}}"></paper-icon-button>
      </paper-input>
      <iron-data-table id="dataTable" items="[[_dataSearch.results]]" selected-item="{{_selectedSearchPart}}" selection-enabled="" loading="{{_loading}}">
        <data-table-column width="40px">
          <template>
            <iron-image src="[[item.img_url]]" preload="" style="width:40px; height:40px" sizing="contain"></iron-image>
          </template>
        </data-table-column>
        <data-table-column name="ID" width="80px">
          <template>[[item.part_id]]</template>
        </data-table-column>
        <data-table-column name="Description" flex="10">
          <template>[[item.descr]]</template>
        </data-table-column>
      </iron-data-table>
      <paper-input autofocus="" hidden$="{{!showQuantityInput}}" id="_quantityInput" label="Quantity" min="1" value="{{quantity}}" type="number">
      </paper-input>

      <div class="buttons">
        <paper-button dialog-dismiss="">Cancel</paper-button>
        <paper-button dialog-confirm="" disabled="{{!_searchDialogOk}}">Accept</paper-button>
      </div>
    </paper-dialog>
    <iron-ajax id="theAjaxSearch" url="https://rebrickable.com/api/search" params="{{_paramsSearch}}" handle-as="json" last-response="{{_dataSearch}}">
    </iron-ajax>


  </template>
  <script>!function(){"use strict";Polymer({is:"part-search-dialog",properties:{result:{type:Object,notify:!0},showQuantityInput:{type:Boolean,value:!1},quantity:{type:Number,value:1,notify:!0,observer:"_onSelectedSearchChanged"},colour:{type:Number,value:null,notify:!0},_paramsSearch:{type:Object},_loading:{type:Boolean,observer:"_onLoadingChanged"},_partTypes:{type:Array},_searchSetType:{type:String,value:"P"},_searchInput:{type:String,observer:"_searchTermsChanged",value:""},_selectedPartType:{type:Object,observer:"_searchTermsChanged",value:null},_selectedPartColour:{type:Object,observer:"_searchTermsChanged",value:null},_dataSearch:{type:Object,value:null},_colours:{type:Array},_selectedSearchPart:{type:Object,value:null,observer:"_onSelectedSearchChanged"},_searchDialogOk:{type:Boolean,value:!1},_searchTermsBad:{type:Boolean,value:!0},_targetKeys:{type:Object,value:function(){return this.$._searchDialogInput}}},_onSearchDialogSearch:function(){this._selectedPartType&&this._selectedPartColour&&(this.set("_paramsSearch",{key:"p4GLMlcPxJ",format:"json",type:this._searchSetType,part_type_id:XP.toNumber(this._selectedPartType.part_type_id),part_color:this._selectedPartColour.rb_color_id,query:this._searchInput}),this.$.theAjaxSearch.generateRequest())},_searchTermsChanged:function(){this.set("_searchTermsBad",""===this._searchInput)},_onSelectedSearchChanged:function(){this.set("_searchDialogOk",null!==this._selectedSearchPart)},_onDialogClosed:function(e){e.detail.confirmed&&(this.set("colour",this._selectedPartColour.rb_color_id),this.set("result",this._selectedSearchPart),this.$._partTypesElement.recentUsed(this._selectedPartType.part_type_id),this.$._colourListElement.recentUsed(this._selectedPartColour.rb_color_id),this.fire("accepted",this.result))},open:function(){this.$._dropdownPartTypeList.selected=0,this.$._dropdownColourList.selected=0,this.$._dialog.open()},_onLoadingChanged:function(){this.fire(this._loading?"loading-started":"loading-finished")}})}();</script>
</dom-module>
</div><dom-module id="list-parts">
  <template>
    <style include="shared-styles">:host{display:block;}</style>
    <paper-toast id="toast">
    </paper-toast>

    <iron-ajax id="theAjax" auto="{{showing}}" url="https://rebrickable.com/api/get_user_part_lists" params="{{_params}}" handle-as="json" on-response="_handleResponse"></iron-ajax>
    <part-search-dialog id="partSearch" on-accepted="_onAddSearchAccepted" quantity="{{_addQuantity}}" colour="{{_addColour}}" show-quantity-input=""></part-search-dialog>
    <paper-material elevation="1">
      <list-of-parts id="listOfParts" user-hash="{{userHash}}" part-list-id="{{partListId}}" parts-changed="{{_partsChanged}}" editable=""></list-of-parts>
      <paper-fab style="position:absolute; bottom: 30px; right:94px" icon="icons:save" on-click="_onSaveClick" hidden$="{{!_partsChanged}}"></paper-fab>
      <paper-fab style="position:absolute; bottom: 30px; right:24px" icon="icons:add" on-click="_onAddClick"></paper-fab>
    </paper-material>
  </template>
  <script>!function(){"use strict";Polymer({is:"list-parts",properties:{userHash:{type:String,observer:"_onHashChanged"},_params:{type:Object},_addColour:{type:Number},_addQuantity:{type:Number},showing:{type:Boolean},tabsToShow:{type:Object,notify:!0},partListId:{type:Number,notify:!0}},_handleResponse:function(t){if(t.detail.response&&(this._data=t.detail.response.partlists,this._data.length>0&&!this.partListId&&this.set("route.path","/app/list-parts/"+this._data[0].partlist_id),this.showing)){var s={selected:this.partListId,route:"parts",tabs:[]};this._data.forEach(function(t){s.tabs.push({route:"/app/list-parts/"+t.partlist_id,title:t.descr})}.bind(this)),this.set("tabsToShow",s),this.saveTabsToShow=s}},_onHashChanged:function(){this.set("_params",{key:"p4GLMlcPxJ",hash:this.userHash,format:"json"})},_onAddClick:function(){this.$.partSearch.open()},_onAddSearchAccepted:function(t){this.$.listOfParts.addPart(t.detail.part_id,t.detail.part_type_id,t.detail.descr,this._addQuantity,this._addColour)},_onSaveClick:function(){this.$.listOfParts.savePartList(function(t){this.$.toast.text=t?"Part List Saved...":"ERROR Saving Part List",this.$.toast.open()}.bind(this))}})}();</script>
</dom-module>
</body></html>