<!DOCTYPE html><html><head>
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,user-scalable=yes">
  <title>set-search-dialog</title>

  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>

  <script src="../bower_components/iron-test-helpers/mock-interactions.js"></script>
  
  <link rel="import" href="../bower_components/iron-test-helpers/iron-test-helpers.html">
  <link rel="import" href="../src/part-search-dialog/part-search-dialog.html">

</head>

<body>

  <test-fixture id="basic">
    <template>
      <part-search-dialog></part-search-dialog>
    </template>
  </test-fixture>

  <script>function runAfterOpen(e,t){var r=function(){e.$$("paper-dialog").removeEventListener("iron-overlay-opened",r),Polymer.Base.async(t,1)};e.$$("paper-dialog").addEventListener("iron-overlay-opened",r),e.open()}function runAfterOpenDropDown(e,t){var r=function(){e.$.menuButton.$.dropdown.removeEventListener("iron-overlay-opened",r),Polymer.Base.async(t,1)};e.$.menuButton.$.dropdown.addEventListener("iron-overlay-opened",r),MockInteractions.tap(e)}describe("part-search-dialog tests",function(){var e,t,r,o,p,n,a,c,i,s;afterEach(function(){t.restore(),e.removeEventListener("loading-finished",c),e.removeEventListener("accepted",i)}),beforeEach(function(){e=fixture("basic"),t=sinon.fakeServer.create(),r=e.$$("#_dropdownPartType"),o=e.$$("#_dropdownColour"),p=e.$$("#_searchDialogInput"),n=e.$$("[dialog-confirm]"),a=e.$$("#dataTable"),s=e.$$("#_quantityInput"),t.respondWith("https://rebrickable.com/api/search?key=p4GLMlcPxJ&format=json&type=P&part_type_id=3&part_color=11&query=nothing",[200,{"Content-Type":"application/json"},'{"results":[]}']),t.respondWith("https://rebrickable.com/api/get_part_types?key=p4GLMlcPxJ&format=json",[200,{"Content-Type":"application/json"},'{ "part_types": [{ "part_type_id": "3", "desc": "Bricks" }, {"part_type_id": "20", "desc": "Bricks Curved" }, {"part_type_id": "18", "desc": "Bricks Printed" }, {"part_type_id": "38", "desc": "Bricks Round and Cones" }, {"part_type_id": "19", "desc": "Bricks Sloped" }, {"part_type_id": "21", "desc": "Bricks Special" }, {"part_type_id": "22", "desc": "Bricks Wedged"  }]}']),t.respondWith("https://rebrickable.com/api/search?key=p4GLMlcPxJ&format=json&type=P&part_type_id=20&part_color=10&query=Arch",[200,{"Content-Type":"application/json"},'{"results":[{"part_id":"6182","descr":"Brick Arch 1 x 4 x 2","part_type":"Bricks Curved","part_type_id":"20","num_parts":"139","num_sets":"468","num_colors":21,"min_year":"1994","max_year":"2016","url":"https://rebrickable.com/parts/6182/brick-arch-1-x-4-x-2","img_url":"https://img.rebrickable.com/img/pieces/elements/618201.jpg"},{"part_id":"3659","descr":"Brick Arch 1 x 4","part_type":"Bricks Curved","part_type_id":"20","num_parts":"480","num_sets":"1698","num_colors":24,"min_year":"1976","max_year":"2016","url":"https://rebrickable.com/parts/3659/brick-arch-1-x-4","img_url":"https://img.rebrickable.com/img/pieces/elements/4211435.jpg"}]}']),e.$._partTypesElement.$.theAjax.generateRequest(),t.respondImmediately=!0,Polymer.dom.flush()}),it("initial state checks",function(t){runAfterOpen(e,function(){expect(r).to.be.ok,expect(o).to.be.ok,expect(p).to.be.ok,expect(n).to.be.ok,expect(a).to.be.ok,expect(s).to.be.ok,r.noAnimations=!0,o.noAnimations=!0,expect(r).to.have.property("selectedItem").that.is.ok,expect(o).to.have.property("selectedItem").that.is.ok,expect(s).to.have.property("hidden",!0),expect(e).to.have.property("_partTypes")["with"].lengthOf(7),expect(e).to.have.property("_colours")["with"].lengthOf(133),expect(p).to.have.property("value",""),expect(n).to.have.property("disabled",!0),expect(a).to.have.property("selectionEnabled",!0),t()})}),it("search for Arch Bricks",function(t){c=function(){e.removeEventListener("loading-finished",c),flush(function(){console.log("search"),expect(e._dataSearch).to.be.ok,expect(e._dataSearch.results).to.have.lengthOf(2),expect(n).to.have.property("disabled",!0),expect(a).to.have.property("size",2),a.selectItem(1),Polymer.dom.flush(),expect(n).to.have.property("disabled",!1),expect(e).to.have.property("_selectedSearchPart",e._dataSearch.results[1]),MockInteractions.tap(Polymer.dom(e.root).querySelector("[dialog-confirm]"))})},i=function(){flush(function(){console.log("done"),expect(e).to.have.property("result",e._dataSearch.results[1]),t()})},runAfterOpen(e,function(){e.addEventListener("accepted",i),runAfterOpenDropDown(r,function(){var t=Polymer.dom(r).querySelectorAll("paper-item")[1];expect(t).to.have.property("part_type_id","20"),MockInteractions.tap(t),Polymer.dom.flush(),expect(e).to.have.deep.property("_selectedPartType.part_type_id","20"),runAfterOpenDropDown(o,function(){var t=Polymer.dom(o).querySelectorAll("paper-item")[10];expect(t).to.have.property("rb_color_id",10),MockInteractions.tap(t),Polymer.dom.flush(),expect(e).to.have.deep.property("_selectedPartColour.rb_color_id",10),e._searchInput="Arch",expect(p).to.have.property("value","Arch"),Polymer.dom.flush(),e.addEventListener("loading-finished",c),MockInteractions.pressEnter(Polymer.dom(e.root).querySelector("#_searchDialogInput"))})})})}),it("search for nothing",function(t){c=function(){expect(a).to.have.property("size",0),expect(n).to.have.property("disabled",!0),t()},i=function(){},runAfterOpen(e,function(){runAfterOpenDropDown(r,function(){var t=Polymer.dom(r).querySelectorAll("paper-item")[1];expect(t).to.have.property("part_type_id","3"),MockInteractions.tap(t),Polymer.dom.flush(),expect(e).to.have.deep.property("_selectedPartType.part_type_id","3"),runAfterOpenDropDown(o,function(){var t=Polymer.dom(o).querySelectorAll("paper-item")[11];expect(t).to.have.property("rb_color_id",11),MockInteractions.tap(t),Polymer.dom.flush(),expect(e).to.have.deep.property("_selectedPartColour.rb_color_id",11),e._searchInput="nothing",expect(p).to.have.property("value","nothing"),Polymer.dom.flush(),e.addEventListener("loading-finished",c),MockInteractions.pressEnter(Polymer.dom(e.root).querySelector("#_searchDialogInput"))})})})}),it("quantity input",function(t){runAfterOpen(e,function(){expect(s).to.have.property("hidden",!0),e.showQuantityInput=!0,expect(s).to.have.property("hidden",!1),t()})})});</script>




</body></html>